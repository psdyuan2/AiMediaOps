# Web 测试页面设计方案

## 一、设计目标

构建一个简单但功能完整的 Web 测试页面，用于：
- 测试 API 接口功能
- 可视化任务管理操作
- 实时查看任务状态
- 验证调度器功能

## 二、技术选型

### 方案选择

**推荐方案：纯前端 + FastAPI 静态文件服务**

**技术栈**：
- **HTML5 + CSS3**: 基础页面结构
- **原生 JavaScript (ES6+)**: API 调用和交互逻辑
- **FastAPI StaticFiles**: 静态文件服务
- **可选轻量级 CSS 框架**: 使用 Tailwind CSS CDN 或 Bootstrap CDN（可选，用于快速美化）

**优势**：
- ✅ 简单直接，无需额外构建工具
- ✅ 易于部署和维护
- ✅ 不依赖复杂的前端框架
- ✅ 可以快速验证功能

### 备选方案

如果需要更丰富的交互，可以考虑：
- **Vue.js 3** (CDN 版本) - 响应式数据绑定
- **React** (CDN 版本) - 组件化开发
- **Alpine.js** - 轻量级响应式框架

## 三、页面功能设计

### 3.1 页面布局

```
┌─────────────────────────────────────────────────┐
│  任务调度器管理平台                              │
├─────────────────────────────────────────────────┤
│  [调度器控制区]                                  │
│  ┌─────────────┐  ┌─────────────┐              │
│  │ 启动调度器  │  │ 停止调度器  │              │
│  └─────────────┘  └─────────────┘              │
│  状态: 运行中 | 总任务: 5 | 运行中: 1           │
├─────────────────────────────────────────────────┤
│  [任务列表区]                                    │
│  ┌───────────────────────────────────────────┐  │
│  │ 任务ID   账户    状态    下次执行时间     │  │
│  │ task_1   acc_1   pending  2026-01-08...  │  │
│  │   [暂停] [恢复] [删除] [调整优先级]      │  │
│  └───────────────────────────────────────────┘  │
├─────────────────────────────────────────────────┤
│  [创建任务区]                                    │
│  ┌───────────────────────────────────────────┐  │
│  │ 账户ID: [____]  账户名: [____]           │  │
│  │ 查询内容: [____]  主题: [____]           │  │
│  │ 执行间隔: [3600]秒  时间范围: [8-22]     │  │
│  │              [创建任务]                   │  │
│  └───────────────────────────────────────────┘  │
└─────────────────────────────────────────────────┘
```

### 3.2 核心功能

#### 3.2.1 调度器控制
- **显示调度器状态**: 运行状态、任务统计
- **启动/停止按钮**: 控制调度器运行
- **实时刷新**: 定时更新状态（每5秒）

#### 3.2.2 任务列表
- **任务表格**: 显示所有任务的关键信息
- **状态标识**: 不同状态用不同颜色标识
- **操作按钮**: 每个任务的操作按钮（暂停/恢复/删除/调整优先级）
- **筛选功能**: 按账户ID或状态筛选
- **自动刷新**: 定时刷新任务列表（每10秒）

#### 3.2.3 创建任务
- **表单输入**: 所有必填和可选参数
- **表单验证**: 前端验证必填字段
- **错误提示**: 显示创建失败的错误信息
- **成功反馈**: 创建成功后刷新列表

#### 3.2.4 任务详情
- **详情弹窗**: 点击任务可查看详细信息
- **执行历史**: 显示执行轮次、执行时间等

### 3.3 交互设计

1. **实时更新**: 使用定时器自动刷新数据
2. **操作反馈**: 所有操作都有成功/失败提示
3. **加载状态**: 操作时显示加载动画
4. **错误处理**: 友好的错误提示信息
5. **确认对话框**: 删除等危险操作需要确认

## 四、文件结构

```
app/
└── api/
    └── static/              # 静态文件目录
        ├── index.html       # 主页面
        ├── css/
        │   └── style.css    # 样式文件（可选）
        └── js/
            └── app.js       # JavaScript 逻辑
```

或者更简单的单文件方案：

```
app/
└── api/
    └── static/
        └── index.html       # 单文件，包含所有 HTML/CSS/JS
```

## 五、实现细节

### 5.1 API 调用封装

```javascript
// API 基础配置
const API_BASE = '/api/v1';

// 统一的 API 调用函数
async function apiCall(method, endpoint, data = null) {
    const options = {
        method: method,
        headers: {
            'Content-Type': 'application/json',
        }
    };
    
    if (data) {
        options.body = JSON.stringify(data);
    }
    
    const response = await fetch(`${API_BASE}${endpoint}`, options);
    return await response.json();
}
```

### 5.2 数据更新策略

- **调度器状态**: 每5秒刷新一次
- **任务列表**: 每10秒刷新一次
- **手动刷新**: 提供刷新按钮
- **操作后刷新**: 创建/删除/修改后立即刷新

### 5.3 状态管理

使用简单的 JavaScript 对象管理状态：
- 当前任务列表
- 调度器状态
- 加载状态
- 错误信息

### 5.4 UI 组件

- **任务卡片/表格**: 显示任务信息
- **状态标签**: 不同颜色表示不同状态
- **操作按钮组**: 每个任务的操作按钮
- **创建表单**: 模态框或内联表单
- **确认对话框**: 删除确认
- **消息提示**: 成功/错误提示

## 六、样式设计

### 6.1 设计风格

- **简洁现代**: 清晰的布局，易于使用
- **响应式**: 适配不同屏幕尺寸
- **颜色方案**: 
  - 成功: 绿色
  - 警告: 黄色
  - 错误: 红色
  - 信息: 蓝色
  - 状态颜色: pending(灰), running(蓝), paused(黄), completed(绿), error(红)

### 6.2 可选样式框架

- **Tailwind CSS CDN**: 快速构建现代 UI
- **Bootstrap CDN**: 传统但稳定的 UI 框架
- **自定义 CSS**: 完全自定义样式

## 七、实现步骤

### 第一阶段：基础页面
1. 创建 HTML 骨架
2. 添加基本样式
3. 实现 API 调用函数

### 第二阶段：核心功能
1. 实现任务列表显示
2. 实现创建任务表单
3. 实现基本操作（暂停/恢复/删除）

### 第三阶段：增强功能
1. 添加调度器控制
2. 添加实时刷新
3. 添加错误处理
4. 添加操作确认

### 第四阶段：优化
1. 美化界面
2. 优化交互体验
3. 添加加载动画
4. 优化移动端显示

## 八、技术实现方案

### 方案A：单文件方案（推荐用于快速测试）

**优点**：
- 一个 HTML 文件包含所有代码
- 易于部署和分享
- 无需额外的文件管理

**文件**: `app/api/static/index.html`

### 方案B：分离文件方案（推荐用于正式项目）

**优点**：
- 代码组织清晰
- 易于维护和扩展
- 可以按需加载资源

**文件结构**:
```
app/api/static/
├── index.html
├── css/
│   └── style.css
└── js/
    └── app.js
```

## 九、功能清单

### 必须实现的功能
- ✅ 显示任务列表
- ✅ 创建任务
- ✅ 删除任务
- ✅ 暂停/恢复任务
- ✅ 显示调度器状态
- ✅ 启动/停止调度器

### 可选功能
- ⭐ 调整任务优先级（时间偏移）
- ⭐ 任务详情查看
- ⭐ 按账户筛选任务
- ⭐ 按状态筛选任务
- ⭐ 实时状态更新
- ⭐ 操作历史记录

## 十、用户体验考虑

1. **加载提示**: 数据加载时显示加载动画
2. **错误提示**: 操作失败时显示明确的错误信息
3. **成功反馈**: 操作成功时显示提示
4. **确认机制**: 危险操作（删除）需要确认
5. **表单验证**: 创建任务时验证必填字段
6. **自动刷新**: 定时刷新数据，保持最新状态

## 十一、部署方式

### 在 FastAPI 中配置静态文件服务

```python
from fastapi.staticfiles import StaticFiles

# 挂载静态文件目录
app.mount("/static", StaticFiles(directory="app/api/static"), name="static")

# 或者直接提供 index.html
@app.get("/")
async def index():
    return FileResponse("app/api/static/index.html")
```

## 十二、测试建议

1. **功能测试**: 测试所有 CRUD 操作
2. **错误处理**: 测试各种错误情况
3. **边界测试**: 测试空列表、大量任务等情况
4. **浏览器兼容**: 测试主流浏览器（Chrome, Firefox, Safari）

## 总结

**推荐实现方案**：
- 使用**单文件 HTML**（包含内联 CSS 和 JavaScript）
- 使用**原生 JavaScript**，不依赖框架
- 使用 **Tailwind CSS CDN** 快速美化（可选）
- 通过 **FastAPI StaticFiles** 提供服务
- 实现**核心功能**，保持简洁实用

**预计实现时间**：
- 基础版本：1-2小时
- 完整版本：3-4小时

**文件大小**：
- 单文件方案：预计 50-100KB（包含所有代码）

这个方案简单实用，可以快速验证 API 功能，同时为后续扩展留下空间。

